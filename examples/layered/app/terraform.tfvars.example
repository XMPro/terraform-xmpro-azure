# Application Layer Configuration
# Copy this file to terraform.tfvars and customize the values for your environment
#
# IMPORTANT: Deploy infrastructure layer first and get outputs:
# cd ../infra && terraform output

# ============================================================================
# CORE CONFIGURATION
# ============================================================================

company_name = "mycompany"
name_suffix  = "dev001"

# ============================================================================
# INFRASTRUCTURE REFERENCES (from infrastructure outputs)
# ============================================================================

resource_group_name  = "rg-mycompany-dev001"
storage_account_name = "stmycdev001"
storage_sas_token    = ""  # Optional - leave empty to auto-generate. Format: "?sv=2021-06-08&ss=bfqt&srt=sco&sp=rwdlacupiytfx&se=2025-12-31T23:59:59Z&st=2025-01-01T00:00:00Z&spr=https&sig=..."
sql_server_fqdn      = "sql-mycompany-dev001.database.windows.net"

# Service Plan Names
ad_service_plan_name = "plan-ad-mycompany-dev001"
ds_service_plan_name = "plan-ds-mycompany-dev001"
sm_service_plan_name = "plan-sm-mycompany-dev001"
ai_service_plan_name = null  # AI disabled

# Key Vault Names
ad_key_vault_name = "kv-ad-mycompany-dev001"
ds_key_vault_name = "kv-ds-mycompany-dev001"
sm_key_vault_name = "kv-sm-mycompany-dev001"
ai_key_vault_name = ""  # AI disabled

# ============================================================================
# CREDENTIALS & SECRETS
# ============================================================================

# Container Registry
acr_url_product = "xmpro.azurecr.io"
acr_username    = ""  # Leave empty for public registry
acr_password    = ""  # Leave empty for public registry

# Database Credentials
db_admin_username = "xmadmin"
db_admin_password = "YourStrongPassword123!"

# Custom Database Names (optional - defaults to SM, AD, DS, AI)
# Must match the infrastructure layer if using custom names
# sm_database_name = "XMPro_SubscriptionManager"
# ad_database_name = "XMPro_AppDesigner"
# ds_database_name = "XMPro_DataStream"
# ai_database_name = "XMPro_AI"

# Application Admin Credentials
company_admin_password = "P@ssw0rd1234!XM"
site_admin_password    = "P@ssw0rd1234!XM"
ad_encryption_key      = ""  # Leave empty to auto-generate

# ============================================================================
# APPLICATION CONFIGURATION
# ============================================================================

imageversion       = "4.5.3"
is_evaluation_mode = false  # Set to true for evaluation deployments with built-in licenses

# Company Admin Details
company_admin_first_name    = "Admin"
company_admin_last_name     = "User"
company_admin_email_address = ""

# ============================================================================
# FEATURE FLAGS
# ============================================================================

enable_ai               = false
create_stream_host      = true
enable_custom_domain    = false
dns_zone_name           = ""
enable_auto_scale       = false
redis_connection_string = ""  # Example: "myredis.redis.cache.windows.net:6380,password=xxxxx,ssl=True,abortConnect=False"
enable_email_notification = false

# ============================================================================
# SMTP CONFIGURATION
# ============================================================================

smtp_server      = ""
smtp_from_address = "noreply@mycompany.com"
smtp_username    = ""
smtp_password    = ""
smtp_port        = 587
smtp_enable_ssl  = true

# ============================================================================
# SSO CONFIGURATION
# ============================================================================

sso_enabled             = false
sso_azure_ad_client_id  = ""
sso_azure_ad_secret     = ""
sso_business_role_claim = ""
sso_azure_ad_tenant_id  = ""

# ============================================================================
# MONITORING (from infrastructure outputs)
# ============================================================================

log_analytics_workspace_name = "log-mycompany-dev001"
app_insights_name            = "appinsights-mycompany-dev001"

# ============================================================================
# NETWORKING (from infrastructure outputs)
# ============================================================================

# Enable production-grade networking (must match infrastructure layer setting)
# When true: Requires vnet_name and subnet_names from infrastructure outputs
# When false: App Services use public endpoints only
prod_networking_enabled = false

# Optional: Provide these values when prod_networking_enabled = true
# Get from infrastructure outputs:
#   cd ../infra && terraform output vnet_name
#   cd ../infra && terraform output subnet_names
# vnet_name = "vnet-mycompany-dev-dev001"
# subnet_names = {
#   presentation = "presentation"  # Subnet 1: App Services (AD, DS, SM)
#   data         = "data"          # Subnet 2: SQL, Redis, Storage (private endpoints, not used by app layer)
#   aci          = "aci"           # Subnet 3: Stream Host (Azure Container Instances)
#   processing   = "processing"    # Subnet 4: AI services (reserved for future use)
# }

# ============================================================================
# CUSTOM RESOURCE NAMING (Optional)
# ============================================================================

# Override default resource names with custom names
# Leave commented out to use default naming convention: {prefix}-{service}-{company_name}-{suffix}
# When specified, custom names must meet Azure naming requirements and character limits

# App Services (max 60 chars)
# name_ad_app_service = "app-ad-custom-dev001"
# name_ds_app_service = "app-ds-custom-dev001"
# name_sm_app_service = "app-sm-custom-dev001"

# Managed Identities (max 128 chars)
# name_ad_identity = "id-ad-custom-dev001"
# name_ds_identity = "id-ds-custom-dev001"
# name_sm_identity = "id-sm-custom-dev001"

# Stream Host Container Instance (max 63 chars)
# name_stream_host_container = "ci-sh-custom-dev001"

# AI App Service (when enable_ai = true, max 60 chars)
# name_ai_app_service = "app-ai-custom-dev001"
# name_ai_identity = "id-ai-custom-dev001"

# ============================================================================
# SECURITY & AUTHORIZATION
# ============================================================================

# NOTE: Key Vault Authorization Model
# This module uses Azure RBAC for Key Vault authorization (not legacy Access Policies)
# - Infrastructure: Terraform principal receives "Key Vault Administrator" role
# - Applications: Managed identities receive "Key Vault Secrets User" role
# - SM: Also receives "Key Vault Certificates User" role for certificate management
# This complies with Azure best practices and enables fine-grained access control

# Custom RBAC Role Names (Optional)
# If your organization uses custom Azure RBAC roles instead of built-in roles,
# specify the custom role names here. Leave commented out to use default built-in roles.
# keyvault_secrets_reader_role_name      = "Custom-KeyVault-Secrets-Reader"
# keyvault_certificates_reader_role_name = "Custom-KeyVault-Certificates-Reader"

# ============================================================================
# TAGS
# ============================================================================

keep_or_delete_tag = "keep"
billing_tag        = "development"
